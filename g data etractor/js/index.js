var t="#upload_error_msg",e="#loading_section",s={uiSettings:{},load:function(){s.addEvents(),s.setSettingsValues(),s.updateScrapeState()},addEvents:function(){$(document).on("click",".close-popup",function(t){self.close()}),$(document).on("click",".export-data-btn",function(t){t.preventDefault(),sendMessage({command:"downloadCSV",data:{}},function(t){})}),$(document).on("click",".clear-data-btn",function(t){confirm("Are you sure you want to clear data!")&&(t.preventDefault(),sendMessage({command:"getSettings"},function(t){s.uiSettings=t.uiSettings,s.uiSettings.current_processed_count=0,s.uiSettings.scrapped_items_arr=[],sendMessage({command:"saveUISettings",data:s.uiSettings},function(t){location.reload()})}))}),$(document).on("submit","#start-search-form",function(a){var i,n,r,o;if(a.preventDefault(),i=$(this),n=!1,r=$(this).find("#Keywords_input").val(),$(t).hide(),$("#authResSection").hide(),"Start Process"==(o=$(this).find('[type="submit"]')).text()){if(""!=r){if(String(r).length<2)return $(t).text("You need to Enter valid keywords"),$(t).show(),!1}else n=!0;if(1==n)return $(t).text("You need to Enter keywords"),$(t).show(),!1;sendMessage({command:"getSettings"},function(t){var a,n,c,d,l;if(s.uiSettings=t.uiSettings,a=s.uiSettings.userRegistered,n=s.uiSettings.total_scrapped_count,c=s.uiSettings.authUser,d=s.uiSettings.last_status_check_time||"",1!=a&&parseInt(n)>=parseInt(atob("NTE=")))return $("#authResSection").show(),$("#authResSection").html('<div class="alert alert-warning alert-dismissible text-center"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Warning!</strong> <i class="fa fa-info-circle"></i> You are not registered or your account is not approved. </a>. <br> If you are not register. Click here to <a href="register.html"> register </a><br><br> Plese Contact With Our Service Member other wise Mail us To All <a style="color: #6a7ddb;" href="mailto:Sales.r2media@gmail.com" target="_blank"> Sales.r2media@gmail.com </a>For Activation Of Extention</div>'),!1;l=s.checkAuthStatus(c,d),parseInt(n)>=parseInt(atob("NTE="))&&1==l?($(e).show(),i.find('[type="submit"]').attr("disabled","disabled"),sendMessage({command:"checkAuthStatus",data:{}},function(t){if($(e).hide(),i.find('[type="submit"]').removeAttr("disabled"),$("#authResSection").show(),t&&t==atob("MQ=="))o.text("Stop & Download CSV"),o.removeClass("start-proccess-btn"),o.addClass("stop-proccess-btn"),$("#currentProcessedCount").text(0),sendMessage({command:"startSearchProcess",data:{Keywords_input:r}},function(t){});else{if(t&&atob("Mg=="))return $("#authResSection").html('<div class="alert alert-warning alert-dismissible text-center"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Warning!</strong> <i class="fa fa-info-circle"></i> You are not registered or your account is not approved. </a>. <br> If you are not register. Click here to <a href="register.html"> register </a><br><br> Plese Contact With Our Service Member other wise Mail us To All <a style="color: #6a7ddb;" href="mailto:Sales.r2media@gmail.com" target="_blank"> Sales.r2media@gmail.com </a>For Activation Of Extention</div>'),!1;$("#authResSection").html('<div class="alert alert-danger alert-dismissible text-center"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Error!</strong> <i class="fa fa-times"></i> Something went wrong please try again.</div>')}})):(o.text("Stop & Download CSV"),o.removeClass("start-proccess-btn"),o.addClass("stop-proccess-btn"),$(".clear-data-btn,.export-data-btn").show(),$("#currentProcessedCount").text(0),sendMessage({command:"startSearchProcess",data:{Keywords_input:r}},function(t){}))})}else o.text("Start Process"),o.removeClass("stop-proccess-btn"),o.addClass("start-proccess-btn"),sendMessage({command:"stopAutoBotProcess",reason:"manual_stop"},function(t){})})},checkAuthStatus:function(t,e){var a,i=!1;return""==e&&(e=(new Date).getTime()),a=daysBetween(e,(new Date).getTime()),1==(i=(a=parseInt(a))>10||1!=t)&&setTimeout(function(){sendMessage({command:"getSettings"},function(t){s.uiSettings=t.uiSettings,s.uiSettings.last_status_check_time=(new Date).getTime(),sendMessage({command:"saveUISettings",data:s.uiSettings},function(t){})})},1e3),i},setSettingsValues:function(){sendMessage({command:"getSettings"},function(t){var e,a;s.uiSettings=t.uiSettings,e=s.uiSettings.scrape_status,a=$("#start-search-form").find('[type="submit"]'),"Finished"==e?(a.text("Start Process"),a.removeClass("stop-proccess-btn"),a.addClass("start-proccess-btn")):"Inprogress"==e?(a.text("Stop & Download CSV"),a.removeClass("start-proccess-btn"),a.addClass("stop-proccess-btn")):(a.text("Start Process"),a.removeClass("stop-proccess-btn"),a.addClass("start-proccess-btn"))})},showScrapeItemsList:function(){sendMessage({command:"getSettings"},function(t){var e,a,i;for(s.uiSettings=t.uiSettings,e=s.uiSettings.scrapped_items_arr,a="",i=0;i<e.length;i++)a+='<tr><td><div style="width: 20px;">'+(i+1)+' </div> </td><td><div style="width: 100px;">'+e[i].name+' </div> </td><td><div style="width: 100px;">'+e[i].address+'</div> </td><td><div style="width: 50px;">'+(e[i].zip?e[i].zip:"")+'</div> </td><td><div style="width: 150px;">'+(""!=e[i].phone_number?'<a href="tel:'+e[i].phone_number+'"> <i class="fa fa-phone"></i> '+e[i].phone_number+"</a>":"")+' </div> </td><td><div style="width: 220px;">'+(""!=e[i].website?'<a target="_blank" href="'+(null!=e[i].website&&""!=e[i].website&&"#"!=e[i].website?e[i].website:"#")+'">'+(null!=e[i].website&&""!=e[i].website&&"#"!=e[i].website?'<i class="fa fa-link"></i>'+e[i].website:"")+"</a>":"")+' </div> </td><td><div style="width: 100px;">'+e[i].latitude+' </div> </td><td><div style="width: 100px;">'+e[i].longitude+" </div> </td></tr>";"Finished"==s.uiSettings.scrape_status&&e.length>0?$(".clear-data-btn,.export-data-btn").show():(0==e.length&&(a+='<tr><td class="text-center text-danger" colspan="8"> No data found! </td></tr>'),$(".clear-data-btn,.export-data-btn").hide()),$("#tbl_items_list").html(a)})},updateScrapeState:function(){sendMessage({command:"getSettings"},function(t){var e,a,i,n;if(s.uiSettings=t.uiSettings,s.setSettingsValues(),s.showScrapeItemsList(),e=s.uiSettings.total_scrapped_count,a=s.uiSettings.current_processed_count,$("#currentProcessedCount").text(a),$("#totalScrappedItems").text(e),i=s.uiSettings.userRegistered,n=s.uiSettings.authUser,1!=i&&(e=s.uiSettings.total_scrapped_count,parseInt(e)>=parseInt(atob("NTE="))))return $("#authResSection").show(),$("#authResSection").html('<div class="alert alert-warning alert-dismissible text-center"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Warning!</strong> <i class="fa fa-info-circle"></i> You are not registered or your account is not approved. </a>. <br> If you are not register. Click here to <a href="register.html"> register </a><br><br> Plese Contact With Our Service Member other wise Mail us To All <a style="color: #6a7ddb;" href="mailto:Sales.r2media@gmail.com" target="_blank"> Sales.r2media@gmail.com </a>For Activation Of Extention</div>'),!1;1!=i&&1!=n||$('[href="register.html"]').hide()})}};function sendMessage(t,e){null!=e&&(t.callback="yes"),chrome.runtime.sendMessage(t,e)}function sendMessageActiveTab(t,e){chrome.tabs.query({active:!0,currentWindow:!0},function(s){chrome.tabs.sendMessage(s[0].id,t,e)})}function handleMessage(t,e){switch(t.command){case"rec_getSettings":s.uiSettings=t.data.uiSettings;break;case"updateScrapeState":s.updateScrapeState()}void 0!==t.data&&void 0!==t.data.callback&&"yes"==t.data.callback&&(callback(),callback=null)}function treatAsUTC(t){var e=new Date(t);return e.setMinutes(e.getMinutes()-e.getTimezoneOffset()),e}function daysBetween(t,e){return(treatAsUTC(e)-treatAsUTC(t))/864e5}$(document).ready(function(){s.load(),chrome.runtime.onMessage.addListener(handleMessage)});